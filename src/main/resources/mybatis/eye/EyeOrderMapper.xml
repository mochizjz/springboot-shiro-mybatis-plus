<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ins.webeye.project.eye.order.mapper.EyeOrderMapper">
    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="ins.webeye.project.eye.order.domain.EyeOrder">
        <result property="id"    column="id"    />
        <result property="token"    column="token"    />
        <result property="sysCode"    column="sys_code"    />
        <result property="orderId"    column="order_id"    />
        <result property="productCode"    column="product_code"    />
        <result property="productName"    column="product_name"    />
        <result property="policyNo"    column="policy_no"    />
        <result property="policyName"    column="policy_name"    />
        <result property="policyIdcard"    column="policy_idcard"    />
        <result property="checkStatus"    column="check_status"    />
        <result property="checkMessage"    column="check_message"    />
        <result property="checkTime"    column="check_time"    />
        <result property="verifyCode"    column="verify_code"    />
        <result property="verifyTime"    column="verify_time"    />
        <result property="verifyThirdParty"    column="verify_third_party"    />
        <result property="fileSize"    column="file_size"    />
        <result property="isLitigations"    column="is_litigations"    />
        <result property="archStatus"    column="arch_status"    />
        <result property="archTime"    column="arch_time"    />
        <result property="status"    column="status"    />
        <result property="createUser"    column="create_user"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateUser"    column="update_user"    />
        <result property="updateTime"    column="update_time"    />
        <result property="flag"    column="flag"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, token, sys_code,order_id, product_code, product_name, policy_no, policy_name, policy_idcard, status, create_user, create_time, update_user, update_time, flag, remark, check_status, check_message, check_time, verify_code, verify_time, verify_third_party , file_size, is_litigations, arch_status, arch_time
    </sql>

    <resultMap type="EyeOrder" id="EyeOrderResult">
        <result property="id"    column="id"    />
        <result property="token"    column="token"    />
        <result property="sysCode"    column="sys_code"    />
        <result property="orderId"    column="order_id"    />
        <result property="productCode"    column="product_code"    />
        <result property="productName"    column="product_name"    />
        <result property="policyNo"    column="policy_no"    />
        <result property="policyName"    column="policy_name"    />
        <result property="policyIdcard"    column="policy_idcard"    />
        <result property="checkStatus"    column="check_status"    />
        <result property="checkMessage"    column="check_message"    />
        <result property="checkTime"    column="check_time"    />
        <result property="verifyCode"    column="verify_code"    />
        <result property="verifyTime"    column="verify_time"    />
        <result property="verifyThirdParty"    column="verify_third_party"    />
        <result property="fileSize"    column="file_size"    />
        <result property="isLitigations"    column="is_litigations"    />
        <result property="archStatus"    column="arch_status"    />
        <result property="archTime"    column="arch_time"    />
        <result property="status"    column="status"    />
        <result property="createUser"    column="create_user"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateUser"    column="update_user"    />
        <result property="updateTime"    column="update_time"    />
        <result property="flag"    column="flag"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <sql id="selectEyeOrderVo">
        select id, token, sys_code,order_id, product_code, product_name, policy_no, policy_name, policy_idcard, status, create_user, create_time, update_user, update_time, flag, remark, check_status, check_message, check_time, verify_code, verify_time, verify_third_party , file_size, is_litigations, arch_status, arch_time from eye_order
    </sql>

    <select id="selectEyeOrderList" parameterType="EyeOrder" resultMap="EyeOrderResult">
        <include refid="selectEyeOrderVo"/>
        <where>  
            <if test="token != null  and token != ''"> and token = #{token}</if>
            <if test="sysCode != null  and sysCode != ''"> and sys_code = #{sysCode}</if>
            <if test="orderId != null  and orderId != ''"> and order_id = #{orderId}</if>
            <if test="productCode != null  and productCode != ''"> and product_code = #{productCode}</if>
            <if test="productName != null  and productName != ''"> and product_name like concat('%', #{productName}, '%')</if>
            <if test="policyNo != null  and policyNo != ''"> and policy_no = #{policyNo}</if>
            <if test="policyName != null  and policyName != ''"> and policy_name like concat('%', #{policyName}, '%')</if>
            <if test="policyIdcard != null  and policyIdcard != ''"> and policy_idcard = #{policyIdcard}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="createUser != null  and createUser != ''"> and create_user = #{createUser}</if>
            <if test="updateUser != null  and updateUser != ''"> and update_user = #{updateUser}</if>
            <if test="flag != null  and flag != ''"> and flag = #{flag}</if>
            <if test="checkStatus != null  and checkStatus != ''"> and check_status = #{checkStatus}</if>
            <if test="checkMessage != null  and checkMessage != ''"> and check_message = #{checkMessage}</if>
            <if test="checkTime != null "> and check_time = #{checkTime}</if>
            <if test="verifyCode != null  and verifyCode != ''"> and verify_code = #{verifyCode}</if>
            <if test="verifyTime != null "> and verify_time = #{verifyTime}</if>
            <if test="verifyThirdParty != null  and verifyThirdParty != ''"> and verify_third_party = #{verifyThirdParty}</if>
            
            <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
				and date_format(create_time,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
			</if>
			<if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
				and date_format(create_time,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
			</if>
			
			<!-- <if test="fileSize != null and archStatus != 0"> and file_size = #{fileSize}</if> -->
            <if test="isLitigations != null  and isLitigations != ''"> and is_litigations = #{isLitigations}</if>
            <if test="archStatus != null  and archStatus != ''"> and arch_status = #{archStatus}</if>
            <if test="archTime != null "> and arch_time = #{archTime}</if>
        </where>
        order by create_time desc
    </select>
    
    <select id="selectEyeOrderById" parameterType="Long" resultMap="EyeOrderResult">
        <include refid="selectEyeOrderVo"/>
        where id = #{id}
    </select>

    <select id="selectEyeOrderByOrderId" parameterType="String" resultMap="EyeOrderResult">
        <include refid="selectEyeOrderVo"/>
        where order_id = #{orderId}
    </select>

    <select id="selectEyeOrderByPolicyNo" parameterType="String" resultMap="EyeOrderResult">
        <include refid="selectEyeOrderVo"/>
        where policy_no = #{policyNo}
    </select>

    <insert id="insertEyeOrder" parameterType="EyeOrder" useGeneratedKeys="true" keyProperty="id">
        insert into eye_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="token != null">token,</if>
            <if test="sysCode != null">sys_code,</if>
            <if test="orderId != null">order_id,</if>
            <if test="productCode != null">product_code,</if>
            <if test="productName != null">product_name,</if>
            <if test="policyNo != null">policy_no,</if>
            <if test="policyName != null">policy_name,</if>
            <if test="policyIdcard != null">policy_idcard,</if>
            <if test="status != null">status,</if>
            <if test="createUser != null">create_user,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateUser != null">update_user,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="flag != null">flag,</if>
            <if test="remark != null">remark,</if>
            <if test="checkStatus != null">check_status,</if>
            <if test="checkMessage != null">check_message,</if>
            <if test="checkTime != null">check_time,</if>
            <if test="verifyCode != null">verify_code,</if>
            <if test="verifyTime != null">verify_time,</if>
            <if test="verifyThirdParty != null">verify_third_party,</if>
            <if test="fileSize != null">file_size,</if>
            <if test="isLitigations != null">is_litigations,</if>
            <if test="archStatus != null">arch_status,</if>
            <if test="archTime != null">arch_time,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="token != null">#{token},</if>
            <if test="sysCode != null">#{sysCode},</if>
            <if test="orderId != null">#{orderId},</if>
            <if test="productCode != null">#{productCode},</if>
            <if test="productName != null">#{productName},</if>
            <if test="policyNo != null">#{policyNo},</if>
            <if test="policyName != null">#{policyName},</if>
            <if test="policyIdcard != null">#{policyIdcard},</if>
            <if test="status != null">#{status},</if>
            <if test="createUser != null">#{createUser},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateUser != null">#{updateUser},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="flag != null">#{flag},</if>
            <if test="remark != null">#{remark},</if>
            <if test="checkStatus != null">#{checkStatus},</if>
            <if test="checkMessage != null">#{checkMessage},</if>
            <if test="checkTime != null">#{checkTime},</if>
            <if test="verifyCode != null">#{verifyCode},</if>
            <if test="verifyTime != null">#{verifyTime},</if>
            <if test="verifyThirdParty != null">#{verifyThirdParty},</if>
            <if test="fileSize != null">#{fileSize},</if>
            <if test="isLitigations != null">#{isLitigations},</if>
            <if test="archStatus != null">#{archStatus},</if>
            <if test="archTime != null">#{archTime},</if>
         </trim>
    </insert>

    <update id="updateEyeOrder" parameterType="EyeOrder">
        update eye_order
        <trim prefix="SET" suffixOverrides=",">
            <if test="token != null">token = #{token},</if>
            <if test="sysCode != null">sys_code = #{sysCode},</if>
            <if test="orderId != null">order_id = #{orderId},</if>
            <if test="productCode != null">product_code = #{productCode},</if>
            <if test="productName != null">product_name = #{productName},</if>
            <if test="policyNo != null">policy_no = #{policyNo},</if>
            <if test="policyName != null">policy_name = #{policyName},</if>
            <if test="policyIdcard != null">policy_idcard = #{policyIdcard},</if>
            <if test="status != null">status = #{status},</if>
            <if test="createUser != null">create_user = #{createUser},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateUser != null">update_user = #{updateUser},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="flag != null">flag = #{flag},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="checkStatus != null">check_status = #{checkStatus},</if>
            <if test="checkMessage != null">check_message = #{checkMessage},</if>
            <if test="checkTime != null">check_time = #{checkTime},</if>
            <if test="verifyCode != null">verify_code = #{verifyCode},</if>
            <if test="verifyTime != null">verify_time = #{verifyTime},</if>
            <if test="verifyThirdParty != null">verify_third_party = #{verifyThirdParty},</if>
            <if test="fileSize != null">file_size = #{fileSize},</if>
            <if test="isLitigations != null">is_litigations = #{isLitigations},</if>
            <if test="archStatus != null">arch_status = #{archStatus},</if>
            <if test="archTime != null">arch_time = #{archTime},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteEyeOrderById" parameterType="Long">
        delete from eye_order where id = #{id}
    </delete>

    <delete id="deleteEyeOrderByIds" parameterType="String">
        delete from eye_order where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <update id="updateByOrderId" parameterType="EyeOrder" >
        update eye_order
        <trim prefix="SET" suffixOverrides=",">
            <if test="productName != null">product_name = #{productName},</if>
            <if test="updateUser != null">update_user = #{updateUser},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="policyNo != null">policy_no = #{policyNo},</if>
            <if test="policyName != null">policy_name = #{policyName},</if>
            <if test="policyIdcard != null">policy_idcard = #{policyIdcard},</if>
        </trim>
        where order_id = #{orderId}
    </update>
    <!-- 工作台报表查询  -->
 	<select id="selectOrderDayNum"  resultType="int">
 	  select count(1) from eye_order where date(create_time) = curdate();
    </select>
    <select id="selectOrderMonthNum"  resultType="int">
	  select count(1) from eye_order where date_format(create_time,'%Y-%m')=date_format(now(),'%Y-%m');
    </select>
     <select id="selectOrderDayFailNum"  resultType="int">
 	  select count(1) from eye_order where date(create_time) = curdate() and check_status = 1;
    </select>
<!--    <select id="selectById" resultType="ins.webeye.project.eye.order.domain.EyeOrder"></select>-->
</mapper>